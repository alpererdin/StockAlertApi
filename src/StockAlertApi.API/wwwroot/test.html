<!DOCTYPE html>
<html>
<head>
    <title>SignalR Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@latest/dist/browser/signalr.min.js"></script>
</head>
<body>
    <h1>Stock Alert Test</h1>
    <input type="text" id="userId" placeholder="User ID" value="cca95b93-51c1-449b-8474-9d95bbf3e860" style="width: 300px;" />
    <button onclick="connect()">Connect</button>
    <button onclick="disconnect()">Disconnect</button>
    <hr>
    <div id="status">Not connected</div>
    <hr>
    <h2>Alerts:</h2>
    <div id="messages" style="border: 1px solid black; padding: 10px; min-height: 200px;"></div>

    <script>
        let connection;

        function connect() {
            const userId = document.getElementById('userId').value;
            connection = new signalR.HubConnectionBuilder()
                .withUrl(`/alertHub?userId=${userId}`)
                .configureLogging(signalR.LogLevel.Information)
                .build();

            connection.on("AlertTriggered", (data) => {
                const time = new Date().toLocaleTimeString();
                const msg = `[${time}] <strong>ALERT!</strong> ${data.stockSymbol} reached $${data.currentPrice} (Target: $${data.targetPrice})`;
                document.getElementById('messages').innerHTML += `<p style="color: green;">${msg}</p>`;
            });

            connection.start()
                .then(() => {
                    document.getElementById('status').innerHTML = '<span style="color: green;">Connected ✓</span>';
                    console.log("Connected to SignalR");
                })
                .catch(err => {
                    document.getElementById('status').innerHTML = '<span style="color: red;">Connection failed ✗</span>';
                    console.error(err);
                });
        }

        function disconnect() {
            if (connection) {
                connection.stop();
                document.getElementById('status').innerHTML = '<span style="color: gray;">Disconnected</span>';
            }
        }
    </script>
</body>
</html>